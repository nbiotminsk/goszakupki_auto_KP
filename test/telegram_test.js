/**
 * –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π Telegram
 *
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 * 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_BOT_TOKEN –∏ TELEGRAM_CHAT_ID
 *    –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env —Å —ç—Ç–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
 * 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: node test/telegram_test.js
 *
 * –°–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–∫—É–ø–∫–∏
 */

require("dotenv").config();
const TelegramSender = require("../telegramSender");

async function testTelegramSender() {
  console.log("üß™ –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Telegram Sender...\n");

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  const telegramSender = new TelegramSender();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
  console.log("1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Telegram –±–æ—Ç–∞...");
  if (!telegramSender.isAvailable()) {
    console.error("‚ùå Telegram –±–æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_BOT_TOKEN.");
    process.exit(1);
  }
  console.log("‚úÖ Telegram –±–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω\n");

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ
  console.log("2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ...");
  try {
    const botInfo = await telegramSender.getBotInfo();
    console.log("‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ:");
    console.log(`   - ID: ${botInfo.id}`);
    console.log(`   - Username: @${botInfo.username}`);
    console.log(`   - –ò–º—è: ${botInfo.first_name}\n`);
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ:", error.message);
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Ç–∞
  const chatId = process.env.TELEGRAM_CHAT_ID;
  if (!chatId) {
    console.error(
      "‚ùå TELEGRAM_CHAT_ID –Ω–µ —É–∫–∞–∑–∞–Ω. –£–∫–∞–∂–∏—Ç–µ Chat ID –≤ .env —Ñ–∞–π–ª–µ.",
    );
    process.exit(1);
  }

  console.log(`3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Ç–∞ (ID: ${chatId})...`);
  try {
    await telegramSender.checkChat(chatId);
    console.log("‚úÖ –ß–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω\n");
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–∞—Ç–∞:", error.message);
    process.exit(1);
  }

  // –¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫—Ä–∞—Ç–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  console.log("4Ô∏è‚É£ –¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫—Ä–∞—Ç–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏");
  try {
    await telegramSender.sendLink(
      chatId,
      "https://goszakupki.by/single-source/view/123456",
      "üìã –¢–µ—Å—Ç–æ–≤–æ–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
      '–ì–£ "–†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø–æ –∑–∏–º–Ω–∏–º –≤–∏–¥–∞–º —Å–ø–æ—Ä—Ç–∞"',
    );
    console.log("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\n");
    await sleep(2000); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:", error.message);
  }

  // –¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –¥–∞—Ç–æ–π –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
  console.log(
    "5Ô∏è‚É£ –¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –¥–∞—Ç–æ–π –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π",
  );
  try {
    await telegramSender.sendLink(
      chatId,
      "https://goszakupki.by/tender/view/789012",
      "üìã –¢–µ—Å—Ç–æ–≤–æ–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 2",
      null,
      "31.12.2024 12:00",
    );
    console.log("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\n");
    await sleep(2000); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:", error.message);
  }

  // –¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–±–æ–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
  console.log("6Ô∏è‚É£ –¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–±–æ–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏");
  try {
    await telegramSender.sendLink(
      chatId,
      "https://goszakupki.by/request/view/345678",
      "üìã –¢–µ—Å—Ç–æ–≤–æ–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 3",
      '–û–û–û "–¢–µ—Ö–Ω–æ-–°–µ—Ä–≤–∏—Å"',
      "15.01.2025 18:00",
    );
    console.log("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\n");
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:", error.message);
  }

  // –¢–µ—Å—Ç 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ —Å –ø–æ–¥–ø–∏—Å—å—é (—Å–∏–º—É–ª—è—Ü–∏—è)
  console.log(
    "7Ô∏è‚É£ –¢–µ—Å—Ç 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø–æ–¥–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞)",
  );
  const testCaption = `
üìã –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
üì¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –ì–£ \"–ú–∏–Ω—Å–∫–∏–π –≥–æ—Ä–æ–¥—Å–∫–æ–π –¥–≤–æ—Ä–µ—Ü —Å–ø–æ—Ä—Ç–∞\"
‚è∞ –ü–æ–¥–∞—Ç—å –¥–æ: 20.01.2025 10:00
`.trim();
  console.log("üìù –§–æ—Ä–º–∏—Ä—É–µ–º–∞—è –ø–æ–¥–ø–∏—Å—å:");
  console.log(testCaption);
  console.log("\n‚úÖ –¢–µ–∫—Å—Ç –ø–æ–¥–ø–∏—Å–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ\n");

  console.log("üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!");
}

/**
 * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏
 * @param {number} ms - –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
 */
function sleep(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
testTelegramSender().catch((error) => {
  console.error("üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:", error);
  process.exit(1);
});
